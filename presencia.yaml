  # Queca, Chimo y demÃ¡s entra/ha salido de casa
  - alias: 'Cambio de estado de presencia 1'
    trigger:
      platform: state
      entity_id: 
        - device_tracker.chimo
        - device_tracker.queca
        # invitados
        - device_tracker.irene
        # vecinos (PARA PEDIRE LA SAL Y LACERVEZA FRESQUITA)
        
    condition: 
      condition: and
      conditions:
        - condition: time
          # At least one of the following is required.
          after: '08:30:00'
          before: '21:00:00'
        - condition: template
          value_template: "{{ trigger.from_state.state != trigger.to_state.state }}"

    action:
    
    - service: notify.EL_QUE_QUIERAS
      data_template:
        message: >
          {% if trigger.from_state.state | lower == "not_home" %}
            {{ trigger.to_state.name }} ha llegado a {{ trigger.to_state.state | replace("home", "casa") }}
          {% elif trigger.to_state.state| lower == "not_home" %}
            {{ trigger.to_state.name }} ha salido de {{ trigger.from_state.state | replace("home", "casa") }}
          {% endif %}
    - service: notify.EL_DE_LA_JEFA
      data_template:
        message: >
          {% if trigger.from_state.state | lower == "not_home" %}
            {{ trigger.to_state.name }} llega a {{ trigger.to_state.state | replace("home", "casa") }}
          {% elif trigger.to_state.state| lower == "not_home" %}
            {{ trigger.to_state.name }} ha salido de {{ trigger.from_state.state | replace("home", "casa") }}
          {% endif %}

    - service: tts.google_say
      data_template:
        entity_id: media_player.EL_TUYO
        message: >
          {% if trigger.from_state.state | lower == "not_home" %}
            {{ trigger.to_state.name }} ha llegado a {{ trigger.to_state.state | replace("home", "casa") }}
          {% elif trigger.to_state.state| lower == "not_home" %}
            {{ trigger.to_state.name }} ha salido de {{ trigger.from_state.state | replace("home", "casa") }}
          {% endif %}    

#    - service: notify.shieldtv  
#      data_template:
#        message: >
#          {% if trigger.from_state.state | lower == "not_home" %}
#            {{ trigger.to_state.name }} ha llegado a {{ trigger.to_state.state | replace("home", "casa") }}
#          {% elif trigger.to_state.state| lower == "not_home" %}
#            {{ trigger.to_state.name }} ha salido de {{ trigger.from_state.state | replace("home", "casa") }}
#          {% endif %}
#        title: "Aviso de presencia"
#        data:
#          position: "center"
#          duration: 7
#          transparency: "0%"
#          color: green
#          interrupt": 1
